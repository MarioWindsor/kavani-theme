{# templates/page.wishlist.liquid #}

{% comment %}
    The Liquid `{% if customer %}` block and `{% assign wishlist_list = ... %}`
    are removed because the wishlist data is now handled entirely by JavaScript
    from Local Storage.

    The "Login to View Wishlist" block will no longer be necessary if
    you allow guest wishlists via Local Storage.
{% endcomment %}

<section id="wishlist-section" class="wishlist-section space-100-top">
    <div class="row">
        <div class="container">
            <div class="columns small-12">
                <h1 class="collection-title block h5 strong text-uppercase text-center">{{ page.title }}</h1>
                <div class="collection-description block p text-center">{{ page.content }}</div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="container">
            <div class="columns small-12">
                <div id="wishlist-items-container" class="card-grid space-100">
                    {# Wishlist items will be rendered here by JavaScript #}
                    <p class="p block text-center empty-wishlist-message" style="display: none;">Your wishlist is empty.</p>
                </div>
                <div class="wishlist-actions text-center space-50-top">
                    <a href="{{ routes.all_products_collection_url }}" class="button fill-dark box-shadow-white-2">Continue Shopping</a>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const wishlistContainer = document.getElementById('wishlist-items-container');
        const emptyMessage = wishlistContainer.querySelector('.empty-wishlist-message');

        // Ensure the global wishlist object is available
        if (window.wishlistInstance) {
            const items = window.wishlistInstance.getWishlistItems();

            if (items.length > 0) {
                emptyMessage.style.display = 'none'; // Hide empty message

                items.forEach(item => {
                    const productCardHtml = `
                        <div class="card-grid-item">
                            <div class="card product-card fill-white radius-25 box-shadow-red no-overflow">
                                <a class="block" href="${item.url}">
                                    ${item.image ? `
                                    <div class="thumbnail block no-whitespace" style="padding-top: 100%; background-size: cover; background-repeat: no-repeat; background-position: center center; background-image: url('${item.image}');"></div>
                                    ` : ''}
                                    <div class="text-center space-75-top space-75-left-right">
                                        <div class="title h6 text-uppercase no-overflow-text space-min-bottom">${item.title}</div>
                                        <div class="price label text-red strong">${Shopify.formatMoney(item.price, window.Shopify.moneyFormat)}/-</div>
                                    </div>
                                </a>
                                <div class="product-actions row space-25 no-whitespace">
                                    <div class="wishlist columns small-6 space-25">
                                        <button
                                            type="button"
                                            class="button block fill-red text-white wishlist-button in-wishlist" {# Force in-wishlist state for remove button #}
                                            tabindex="0"
                                            data-product-id="${item.id}"
                                            data-product-handle="${item.handle}"
                                            data-product-title="${item.title}"
                                            data-product-image="${item.image}"
                                            data-product-price="${item.price}"
                                            data-product-url="${item.url}"
                                            aria-label="Remove from wishlist"
                                        >
                                            <i class='bx bx-heart text-white' style="display: none;"></i> {# Empty heart (hidden) #}
                                            <i class='bx bxs-heart text-white' style="display: block;"></i> {# Filled heart (visible) #}
                                            <span class="visuallyhidden">Remove from Wishlist</span>
                                        </button>
                                    </div>
                                    <div class="cart columns small-6 space-25">
                                        <form action="/cart/add" method="post" enctype="multipart/form-data">
                                            <input type="hidden" name="id" value="${item.id}"> {# Assuming product ID is also the default variant ID #}
                                            <button class="button block fill-dark text-white box-shadow-black" type="submit">Add to Cart</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    wishlistContainer.insertAdjacentHTML('beforeend', productCardHtml);
                });

                // Re-initialize buttons on this page after dynamic content is added
                window.wishlistInstance.initButtons();
            } else {
                emptyMessage.style.display = 'block'; // Show empty message
            }
        } else {
            console.error('Wishlist object not initialized on wishlist page.');
        }
    });
</script>